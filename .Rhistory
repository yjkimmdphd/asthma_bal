hosp_1yr_unk = sum(is.na(admit_count)),
hosp_1yr_0 = sum(admit_count==0,na.rm=TRUE),
hosp_1yr_1 = sum(admit_count==1,na.rm=TRUE),
hosp_1yr_2 = sum(admit_count>1,na.rm=TRUE),
hosp_1yr_unk_perc = round(sum(is.na(admit_count))/length(admit_count)*100,1),
hosp_1yr_0_perc = round(sum(admit_count==0,na.rm=TRUE)/length(admit_count)*100,1) ,
hosp_1yr_1_perc = round(sum(admit_count==1,na.rm=TRUE)/length(admit_count)*100,1),
hosp_1yr_2_perc = round(sum(admit_count>1,na.rm=TRUE)/length(admit_count)*100,1),
ED_1yr_unk = sum(is.na(ED_visits_past_yr)),
ED_1yr_0 = sum(ED_visits_past_yr==0,na.rm=TRUE),
ED_1yr_1 = sum(ED_visits_past_yr==1,na.rm=TRUE),
ED_1yr_2 = sum(ED_visits_past_yr>1,na.rm=TRUE),
ED_1yr_unk_perc = round(sum(is.na(ED_visits_past_yr))/length(ED_visits_past_yr)*100,1),
ED_1yr_0_perc = round(sum(ED_visits_past_yr==0,na.rm=TRUE)/length(ED_visits_past_yr)*100,1) ,
ED_1yr_1_perc = round(sum(ED_visits_past_yr==1,na.rm=TRUE)/length(ED_visits_past_yr)*100,1),
ED_1yr_2_perc = round(sum(ED_visits_past_yr>1,na.rm=TRUE)/length(ED_visits_past_yr)*100,1),
#rhinosin_sx = ,
#rhinosin_sx_perc = ,
race_asian= race_t[1],
race_black_AA= race_t[2],
race_more_than1= race_t[3],
race_unk = race_t[4],
race_wt = race_t[5],
race_asian_perc= round(race_t[1]/sum(race_t)*100,1),
race_black_AA_perc= round(race_t[2]/sum(race_t)*100,1),
race_more_than1_perc= round(race_t[3]/sum(race_t)*100,1),
race_unk_perc = round(race_t[4]/sum(race_t)*100,1),
race_wt_perc = round(race_t[5]/sum(race_t)*100,1),
ethnicity_lat=table(BoA_phen_BAL$Ethnicity)[1],
ethnicity_lat_perc=round(table(BoA_phen_BAL$Ethnicity)[1]/sum(table(BoA_phen_BAL$Ethnicity)),1),
race_asian_perc= round(race_t[1]/sum(race_t)*100,1),
asthma_med_ICS = length(which(ICS=="Checked")),
asthma_med_SABA= length(which(SABA=="Checked")),
asthma_med_ICS_LABA = length(which(ICS.LABA=="Checked")),
asthma_med_LTR =  length(which(LTR=="Checked")),
asthma_med_xolair.omalizumab = length(which(xolair.omalizumab=="Checked")),
asthma_med_nucala.Mepolizumab = length(which(nucala.Mepolizumab=="Checked")),
asthma_med_fasenra.benralizumab = length(which(fasenra.benralizumab=="Checked")),
asthma_med_atrovent = length(which(atrovent=="Checked")),
##
asthma_med_ICS_perc = round(length(which(ICS=="Checked"))/length(ICS)*100,1),
asthma_med_SABA_perc= round(length(which(SABA=="Checked"))/length(SABA)*100,1),
asthma_med_ICS_LABA_perc = round(length(which(ICS.LABA=="Checked"))/length(ICS.LABA)*100,1),
asthma_med_LTR_perc = round( length(which(LTR=="Checked"))/length(LTR)*100,1),
asthma_med_xolair.omalizumab_perc = round(length(which(xolair.omalizumab=="Checked"))/length(xolair.omalizumab)*100,1),
asthma_med_nucala.Mepolizumab_perc = round(length(which(nucala.Mepolizumab=="Checked"))/length(nucala.Mepolizumab)*100,1),
asthma_med_fasenra.benralizumab_perc = round(length(which(fasenra.benralizumab=="Checked"))/length(fasenra.benralizumab)*100,1),
asthma_med_atrovent_perc = round(length(which(atrovent=="Checked"))/length(atrovent)*100,1)
)
write.csv(BoA_phen_BAL_summary,"./reports/phenotyping/subject_demographic_summary.csv")
BoA_phen_BAL$Ethnicity)[1]/sum(table(BoA_phen_BAL$Ethnicity)*100)
table(BoA_phen_BAL$Ethnicity)[1]/sum(table(BoA_phen_BAL$Ethnicity))*100
BoA_phen_BAL_summary<-BoA_phen_BAL%>%summarize(
Age_mean= round(mean(Age_at_visit),1),
age_sd = round(sd(Age_at_visit),1),
sex_f_numb = length(which(Sex=="Female")),
sex_f_perc = round(length(which(Sex=="Female"))/length(Sex)*100,1),
fev1_pred_mean = round(mean(FEV1_percent,na.rm = TRUE),1),
fev1_pred_sd = round(sd(FEV1_percent,na.rm = TRUE),1),
fev1_fvc_rat_mean = round(mean(FEV1.FVC,na.rm = TRUE),1),
fev1_fvc_rat_sd = round(sd(FEV1.FVC,na.rm = TRUE),1),
all_sens = sum(allergy=="Checked"),
all_sens_perc = round(sum(allergy=="Checked")/sum(table(allergy)),1),
hosp_1yr_unk = sum(is.na(admit_count)),
hosp_1yr_0 = sum(admit_count==0,na.rm=TRUE),
hosp_1yr_1 = sum(admit_count==1,na.rm=TRUE),
hosp_1yr_2 = sum(admit_count>1,na.rm=TRUE),
hosp_1yr_unk_perc = round(sum(is.na(admit_count))/length(admit_count)*100,1),
hosp_1yr_0_perc = round(sum(admit_count==0,na.rm=TRUE)/length(admit_count)*100,1) ,
hosp_1yr_1_perc = round(sum(admit_count==1,na.rm=TRUE)/length(admit_count)*100,1),
hosp_1yr_2_perc = round(sum(admit_count>1,na.rm=TRUE)/length(admit_count)*100,1),
ED_1yr_unk = sum(is.na(ED_visits_past_yr)),
ED_1yr_0 = sum(ED_visits_past_yr==0,na.rm=TRUE),
ED_1yr_1 = sum(ED_visits_past_yr==1,na.rm=TRUE),
ED_1yr_2 = sum(ED_visits_past_yr>1,na.rm=TRUE),
ED_1yr_unk_perc = round(sum(is.na(ED_visits_past_yr))/length(ED_visits_past_yr)*100,1),
ED_1yr_0_perc = round(sum(ED_visits_past_yr==0,na.rm=TRUE)/length(ED_visits_past_yr)*100,1) ,
ED_1yr_1_perc = round(sum(ED_visits_past_yr==1,na.rm=TRUE)/length(ED_visits_past_yr)*100,1),
ED_1yr_2_perc = round(sum(ED_visits_past_yr>1,na.rm=TRUE)/length(ED_visits_past_yr)*100,1),
#rhinosin_sx = ,
#rhinosin_sx_perc = ,
race_asian= race_t[1],
race_black_AA= race_t[2],
race_more_than1= race_t[3],
race_unk = race_t[4],
race_wt = race_t[5],
race_asian_perc= round(race_t[1]/sum(race_t)*100,1),
race_black_AA_perc= round(race_t[2]/sum(race_t)*100,1),
race_more_than1_perc= round(race_t[3]/sum(race_t)*100,1),
race_unk_perc = round(race_t[4]/sum(race_t)*100,1),
race_wt_perc = round(race_t[5]/sum(race_t)*100,1),
ethnicity_lat=table(BoA_phen_BAL$Ethnicity)[1],
ethnicity_lat_perc=round(table(BoA_phen_BAL$Ethnicity)[1]/sum(table(BoA_phen_BAL$Ethnicity))*100,1),
race_asian_perc= round(race_t[1]/sum(race_t)*100,1),
asthma_med_ICS = length(which(ICS=="Checked")),
asthma_med_SABA= length(which(SABA=="Checked")),
asthma_med_ICS_LABA = length(which(ICS.LABA=="Checked")),
asthma_med_LTR =  length(which(LTR=="Checked")),
asthma_med_xolair.omalizumab = length(which(xolair.omalizumab=="Checked")),
asthma_med_nucala.Mepolizumab = length(which(nucala.Mepolizumab=="Checked")),
asthma_med_fasenra.benralizumab = length(which(fasenra.benralizumab=="Checked")),
asthma_med_atrovent = length(which(atrovent=="Checked")),
##
asthma_med_ICS_perc = round(length(which(ICS=="Checked"))/length(ICS)*100,1),
asthma_med_SABA_perc= round(length(which(SABA=="Checked"))/length(SABA)*100,1),
asthma_med_ICS_LABA_perc = round(length(which(ICS.LABA=="Checked"))/length(ICS.LABA)*100,1),
asthma_med_LTR_perc = round( length(which(LTR=="Checked"))/length(LTR)*100,1),
asthma_med_xolair.omalizumab_perc = round(length(which(xolair.omalizumab=="Checked"))/length(xolair.omalizumab)*100,1),
asthma_med_nucala.Mepolizumab_perc = round(length(which(nucala.Mepolizumab=="Checked"))/length(nucala.Mepolizumab)*100,1),
asthma_med_fasenra.benralizumab_perc = round(length(which(fasenra.benralizumab=="Checked"))/length(fasenra.benralizumab)*100,1),
asthma_med_atrovent_perc = round(length(which(atrovent=="Checked"))/length(atrovent)*100,1)
)
write.csv(BoA_phen_BAL_summary,"./reports/phenotyping/subject_demographic_summary.csv")
BoA_phen_BAL_summary<-BoA_phen_BAL%>%summarize(
Age_mean= round(mean(Age_at_visit),1),
age_sd = round(sd(Age_at_visit),1),
sex_f_numb = length(which(Sex=="Female")),
sex_f_perc = round(length(which(Sex=="Female"))/length(Sex)*100,1),
ACT_mean =  round(mean(ACT_score),1),
ACT_mean = round(sd(ACT_score),1),
fev1_pred_mean = round(mean(FEV1_percent,na.rm = TRUE),1),
fev1_pred_sd = round(sd(FEV1_percent,na.rm = TRUE),1),
fev1_fvc_rat_mean = round(mean(FEV1.FVC,na.rm = TRUE),1),
fev1_fvc_rat_sd = round(sd(FEV1.FVC,na.rm = TRUE),1),
all_sens = sum(allergy=="Checked"),
all_sens_perc = round(sum(allergy=="Checked")/sum(table(allergy)),1),
hosp_1yr_unk = sum(is.na(admit_count)),
hosp_1yr_0 = sum(admit_count==0,na.rm=TRUE),
hosp_1yr_1 = sum(admit_count==1,na.rm=TRUE),
hosp_1yr_2 = sum(admit_count>1,na.rm=TRUE),
hosp_1yr_unk_perc = round(sum(is.na(admit_count))/length(admit_count)*100,1),
hosp_1yr_0_perc = round(sum(admit_count==0,na.rm=TRUE)/length(admit_count)*100,1) ,
hosp_1yr_1_perc = round(sum(admit_count==1,na.rm=TRUE)/length(admit_count)*100,1),
hosp_1yr_2_perc = round(sum(admit_count>1,na.rm=TRUE)/length(admit_count)*100,1),
ED_1yr_unk = sum(is.na(ED_visits_past_yr)),
ED_1yr_0 = sum(ED_visits_past_yr==0,na.rm=TRUE),
ED_1yr_1 = sum(ED_visits_past_yr==1,na.rm=TRUE),
ED_1yr_2 = sum(ED_visits_past_yr>1,na.rm=TRUE),
ED_1yr_unk_perc = round(sum(is.na(ED_visits_past_yr))/length(ED_visits_past_yr)*100,1),
ED_1yr_0_perc = round(sum(ED_visits_past_yr==0,na.rm=TRUE)/length(ED_visits_past_yr)*100,1) ,
ED_1yr_1_perc = round(sum(ED_visits_past_yr==1,na.rm=TRUE)/length(ED_visits_past_yr)*100,1),
ED_1yr_2_perc = round(sum(ED_visits_past_yr>1,na.rm=TRUE)/length(ED_visits_past_yr)*100,1),
#rhinosin_sx = ,
#rhinosin_sx_perc = ,
race_asian= race_t[1],
race_black_AA= race_t[2],
race_more_than1= race_t[3],
race_unk = race_t[4],
race_wt = race_t[5],
race_asian_perc= round(race_t[1]/sum(race_t)*100,1),
race_black_AA_perc= round(race_t[2]/sum(race_t)*100,1),
race_more_than1_perc= round(race_t[3]/sum(race_t)*100,1),
race_unk_perc = round(race_t[4]/sum(race_t)*100,1),
race_wt_perc = round(race_t[5]/sum(race_t)*100,1),
ethnicity_lat=table(BoA_phen_BAL$Ethnicity)[1],
ethnicity_lat_perc=round(table(BoA_phen_BAL$Ethnicity)[1]/sum(table(BoA_phen_BAL$Ethnicity))*100,1),
race_asian_perc= round(race_t[1]/sum(race_t)*100,1),
asthma_med_ICS = length(which(ICS=="Checked")),
asthma_med_SABA= length(which(SABA=="Checked")),
asthma_med_ICS_LABA = length(which(ICS.LABA=="Checked")),
asthma_med_LTR =  length(which(LTR=="Checked")),
asthma_med_xolair.omalizumab = length(which(xolair.omalizumab=="Checked")),
asthma_med_nucala.Mepolizumab = length(which(nucala.Mepolizumab=="Checked")),
asthma_med_fasenra.benralizumab = length(which(fasenra.benralizumab=="Checked")),
asthma_med_atrovent = length(which(atrovent=="Checked")),
##
asthma_med_ICS_perc = round(length(which(ICS=="Checked"))/length(ICS)*100,1),
asthma_med_SABA_perc= round(length(which(SABA=="Checked"))/length(SABA)*100,1),
asthma_med_ICS_LABA_perc = round(length(which(ICS.LABA=="Checked"))/length(ICS.LABA)*100,1),
asthma_med_LTR_perc = round( length(which(LTR=="Checked"))/length(LTR)*100,1),
asthma_med_xolair.omalizumab_perc = round(length(which(xolair.omalizumab=="Checked"))/length(xolair.omalizumab)*100,1),
asthma_med_nucala.Mepolizumab_perc = round(length(which(nucala.Mepolizumab=="Checked"))/length(nucala.Mepolizumab)*100,1),
asthma_med_fasenra.benralizumab_perc = round(length(which(fasenra.benralizumab=="Checked"))/length(fasenra.benralizumab)*100,1),
asthma_med_atrovent_perc = round(length(which(atrovent=="Checked"))/length(atrovent)*100,1)
)
write.csv(BoA_phen_BAL_summary,"./reports/phenotyping/subject_demographic_summary.csv")
table(BoA_phen_BAL$ACT_completion_date)
table(BoA_phen_BAL$ACT_score)
BoA_phen_BAL$ACT_score
is.na(BoA_phen_BAL$ACT_score)
is.na(BoA_phen_BAL$ACT_score)%>%sum
is.na(BoA_phen_BAL$ACT_score)%>%which
BoA_phen_BAL[is.na(BoA_phen_BAL$ACT_score)%>%which,]
BoA_phen<-read.csv("./resources/processed_data/BiomarkersOfAsthmaSt_DATA_LABELS_2024-03-06_includes_ACT_score.csv")
BAL_phen<-read.csv("./resources/processed_data/Nasal_Biomarkers_BAL_transformed_with_raceinfo.csv")
bal_confidential<-read.csv("./resources/raw_data/BAL_asthma/confidential_pt/BAL_counts(confidential_with_pt_name).csv")
# use study Id from BAL_phen to subset BoA_phen
BoA_phen_BAL<-BoA_phen[BoA_phen$Study.ID%in%BAL_phen$ID,]
BoA_phen_BAL<-BoA_phen_BAL[, c("Study.ID","Age_at_visit","ED_visits_past_yr","Sex","Race" ,"Ethnicity", "ACT_score","oral_steroid_hx",
"BAL_Date","nasal_swab_date","blood_draw_date","Visit.Date","ACT_completion_date","stopped_asthma_med_date",
"ICS","SABA","ICS.LABA","LTR","xolair.omalizumab","nucala.Mepolizumab","fasenra.benralizumab","atrovent",
"admit_count",
"allergy", # Checked Unchecked
"FEV1_percent", "FEV1.FVC")]
BoA_phen_BAL<-left_join(BoA_phen_BAL,bal_confidential,by="Study.ID")
oralsteroidhx<-data.frame(oral_steroid_hx=letters[1:6],last_on_steroid=factor(c("more than 6mo","w/i 6mo", "w/i 3mo","w/i 1mo","w/i 2wk","currently_on"), levels=c("more than 6mo","w/i 6mo", "w/i 3mo","w/i 1mo","w/i 2wk","currently_on")))
BoA_phen_BAL<-left_join(BoA_phen_BAL,oralsteroidhx,by="oral_steroid_hx")%>%select(Study.ID,Age_at_visit,ED_visits_past_yr,Sex,ACT_score,oral_steroid_hx,last_on_steroid, everything())
# replace empty elements with NA
k<-sapply(BoA_phen_BAL, function(x){ifelse(x=="",NA,x)})%>%as.data.frame
# define function to change dates stored as character vectors to Dates format
k<-sapply(k[, c("BAL_Date","BAL_date","nasal_swab_date","blood_draw_date","blood_date","Visit.Date","ACT_completion_date","stopped_asthma_med_date","a_profile_date")],
function(x){strptime(x, format = "%m/%d/%Y")})%>%as.data.frame()
BoA_phen_BAL[,c("BAL_Date","BAL_date","nasal_swab_date","blood_draw_date","blood_date","Visit.Date","ACT_completion_date","stopped_asthma_med_date","a_profile_date")]<-k
# explore differences in dates
# BAL_Date is bal date from 'BiomarkersOfAsthmaSt_DATA_LABELS'.
# BAL_date is bal date from 'BAL_counts(confidential_with_pt_name)'
# date difference negative means BAL happened later than blood draw or nasal swab; positive means earlier.
BoA_phen_BAL<-BoA_phen_BAL%>%mutate(
BAL_blooddraw_date_diff=difftime(BAL_date, blood_draw_date, units = "days"),
BAL_blood_date_diff=difftime(BAL_date, blood_date, units = "days"),
BAL_nasalswab_date_diff=difftime(BAL_date, nasal_swab_date , units = "days"))
BoA_phen_dates<-BoA_phen_BAL[,c("Study.ID","BAL_blooddraw_date_diff","BAL_blood_date_diff","BAL_nasalswab_date_diff","BAL_Date","BAL_date","nasal_swab_date","blood_draw_date","blood_date")]
write.csv(BoA_phen_dates,"./resources/processed_data/BoA_phen_dates.csv")
# after review, seems like BAL_date [bal date from 'BAL_counts(confidential_with_pt_name)'] is the correct one
data<-BoA_phen_dates%>%subset(!is.na(BAL_blood_date_diff))%>%mutate(BAL_nasalswab_date_diff=BAL_nasalswab_date_diff%>%as.numeric, BAL_blood_date_diff=BAL_blood_date_diff%>%as.numeric)
ggplot(data,aes(x=BAL_nasalswab_date_diff/365, y=BAL_blood_date_diff/365))+
geom_bin2d()+
labs(title = "sample acuisition date differences (BAL, nasal, blood)",
subtitle = "difference (yr)<0: BAL performed later than blood draw or nasal swab \ndifference (yr)>0: BAL performed earlier than blood draw or nasal swab.",
x = "BAL date - nasal sample date (yr)",
y = "BAL date - blood draw date (yr)")+
theme_minimal()+
scale_fill_gradient(low = "cyan", high = "magenta") +  # Customize fill colors
scale_x_continuous(breaks =seq(-3, 1.5, by = 1), minor_breaks = seq(-4, 2, by = 0.5)) +  # Set x-axis tick marks
scale_y_continuous(breaks = seq(-3, 7, by = 1),minor_breaks = seq(-3, 7, by = 0.5))+  # Set y-axis tick marks
geom_vline(xintercept = c(0), color = "black") +
geom_hline(yintercept = c(0), color = "black") +
geom_vline(xintercept = seq(-2,2,by=1), linetype = "dashed", color = "red") +
geom_hline(yintercept = seq(-2,2,by=1), linetype = "dotted", color = "red")+
theme(title=element_text(size=18),
plot.subtitle=element_text(size=10),
axis.text.x = element_text(size = 12),      # Increase x-axis label size
axis.title.x = element_text(size = 14),
axis.text.y = element_text(size = 12),      # Increase y-axis label size
axis.title.y = element_text(size = 14))    # Increase y-axis title size
# find samples that have differce in the dates more than a year
data%>%subset(abs(BAL_blood_date_diff)>365|abs(BAL_nasalswab_date_diff)>365)
# race summary
race_t<-BoA_phen_BAL$Race%>%table
# ED/admit hx
"admit_count"
"ED_visits_past_yr"
# which subjects have spirometry info missing
missing_fev<-BoA_phen_BAL[is.na(BoA_phen_BAL$FEV1_percent),"Study.ID"]
bal_confidential[bal_confidential$Study.ID%in%missing_fev,c("Fist","Last")]
BoA_phen_BAL_summary<-BoA_phen_BAL%>%summarize(
Age_mean= round(mean(Age_at_visit),1),
age_sd = round(sd(Age_at_visit),1),
sex_f_numb = length(which(Sex=="Female")),
sex_f_perc = round(length(which(Sex=="Female"))/length(Sex)*100,1),
ACT_mean =  round(mean(ACT_score),1),
ACT_mean = round(sd(ACT_score),1),
fev1_pred_mean = round(mean(FEV1_percent,na.rm = TRUE),1),
fev1_pred_sd = round(sd(FEV1_percent,na.rm = TRUE),1),
fev1_fvc_rat_mean = round(mean(FEV1.FVC,na.rm = TRUE),1),
fev1_fvc_rat_sd = round(sd(FEV1.FVC,na.rm = TRUE),1),
all_sens = sum(allergy=="Checked"),
all_sens_perc = round(sum(allergy=="Checked")/sum(table(allergy)),1),
hosp_1yr_unk = sum(is.na(admit_count)),
hosp_1yr_0 = sum(admit_count==0,na.rm=TRUE),
hosp_1yr_1 = sum(admit_count==1,na.rm=TRUE),
hosp_1yr_2 = sum(admit_count>1,na.rm=TRUE),
hosp_1yr_unk_perc = round(sum(is.na(admit_count))/length(admit_count)*100,1),
hosp_1yr_0_perc = round(sum(admit_count==0,na.rm=TRUE)/length(admit_count)*100,1) ,
hosp_1yr_1_perc = round(sum(admit_count==1,na.rm=TRUE)/length(admit_count)*100,1),
hosp_1yr_2_perc = round(sum(admit_count>1,na.rm=TRUE)/length(admit_count)*100,1),
ED_1yr_unk = sum(is.na(ED_visits_past_yr)),
ED_1yr_0 = sum(ED_visits_past_yr==0,na.rm=TRUE),
ED_1yr_1 = sum(ED_visits_past_yr==1,na.rm=TRUE),
ED_1yr_2 = sum(ED_visits_past_yr>1,na.rm=TRUE),
ED_1yr_unk_perc = round(sum(is.na(ED_visits_past_yr))/length(ED_visits_past_yr)*100,1),
ED_1yr_0_perc = round(sum(ED_visits_past_yr==0,na.rm=TRUE)/length(ED_visits_past_yr)*100,1) ,
ED_1yr_1_perc = round(sum(ED_visits_past_yr==1,na.rm=TRUE)/length(ED_visits_past_yr)*100,1),
ED_1yr_2_perc = round(sum(ED_visits_past_yr>1,na.rm=TRUE)/length(ED_visits_past_yr)*100,1),
#rhinosin_sx = ,
#rhinosin_sx_perc = ,
race_asian= race_t[1],
race_black_AA= race_t[2],
race_more_than1= race_t[3],
race_unk = race_t[4],
race_wt = race_t[5],
race_asian_perc= round(race_t[1]/sum(race_t)*100,1),
race_black_AA_perc= round(race_t[2]/sum(race_t)*100,1),
race_more_than1_perc= round(race_t[3]/sum(race_t)*100,1),
race_unk_perc = round(race_t[4]/sum(race_t)*100,1),
race_wt_perc = round(race_t[5]/sum(race_t)*100,1),
ethnicity_lat=table(BoA_phen_BAL$Ethnicity)[1],
ethnicity_lat_perc=round(table(BoA_phen_BAL$Ethnicity)[1]/sum(table(BoA_phen_BAL$Ethnicity))*100,1),
race_asian_perc= round(race_t[1]/sum(race_t)*100,1),
asthma_med_ICS = length(which(ICS=="Checked")),
asthma_med_SABA= length(which(SABA=="Checked")),
asthma_med_ICS_LABA = length(which(ICS.LABA=="Checked")),
asthma_med_LTR =  length(which(LTR=="Checked")),
asthma_med_xolair.omalizumab = length(which(xolair.omalizumab=="Checked")),
asthma_med_nucala.Mepolizumab = length(which(nucala.Mepolizumab=="Checked")),
asthma_med_fasenra.benralizumab = length(which(fasenra.benralizumab=="Checked")),
asthma_med_atrovent = length(which(atrovent=="Checked")),
##
asthma_med_ICS_perc = round(length(which(ICS=="Checked"))/length(ICS)*100,1),
asthma_med_SABA_perc= round(length(which(SABA=="Checked"))/length(SABA)*100,1),
asthma_med_ICS_LABA_perc = round(length(which(ICS.LABA=="Checked"))/length(ICS.LABA)*100,1),
asthma_med_LTR_perc = round( length(which(LTR=="Checked"))/length(LTR)*100,1),
asthma_med_xolair.omalizumab_perc = round(length(which(xolair.omalizumab=="Checked"))/length(xolair.omalizumab)*100,1),
asthma_med_nucala.Mepolizumab_perc = round(length(which(nucala.Mepolizumab=="Checked"))/length(nucala.Mepolizumab)*100,1),
asthma_med_fasenra.benralizumab_perc = round(length(which(fasenra.benralizumab=="Checked"))/length(fasenra.benralizumab)*100,1),
asthma_med_atrovent_perc = round(length(which(atrovent=="Checked"))/length(atrovent)*100,1)
)
write.csv(BoA_phen_BAL_summary,"./reports/phenotyping/subject_demographic_summary.csv")
BoA_phen_BAL_summary<-BoA_phen_BAL%>%summarize(
Age_mean= round(mean(Age_at_visit),1),
age_sd = round(sd(Age_at_visit),1),
sex_f_numb = length(which(Sex=="Female")),
sex_f_perc = round(length(which(Sex=="Female"))/length(Sex)*100,1),
ACT_mean =  round(mean(ACT_score),1),
ACT_sd = round(sd(ACT_score),1),
fev1_pred_mean = round(mean(FEV1_percent,na.rm = TRUE),1),
fev1_pred_sd = round(sd(FEV1_percent,na.rm = TRUE),1),
fev1_fvc_rat_mean = round(mean(FEV1.FVC,na.rm = TRUE),1),
fev1_fvc_rat_sd = round(sd(FEV1.FVC,na.rm = TRUE),1),
all_sens = sum(allergy=="Checked"),
all_sens_perc = round(sum(allergy=="Checked")/sum(table(allergy)),1),
hosp_1yr_unk = sum(is.na(admit_count)),
hosp_1yr_0 = sum(admit_count==0,na.rm=TRUE),
hosp_1yr_1 = sum(admit_count==1,na.rm=TRUE),
hosp_1yr_2 = sum(admit_count>1,na.rm=TRUE),
hosp_1yr_unk_perc = round(sum(is.na(admit_count))/length(admit_count)*100,1),
hosp_1yr_0_perc = round(sum(admit_count==0,na.rm=TRUE)/length(admit_count)*100,1) ,
hosp_1yr_1_perc = round(sum(admit_count==1,na.rm=TRUE)/length(admit_count)*100,1),
hosp_1yr_2_perc = round(sum(admit_count>1,na.rm=TRUE)/length(admit_count)*100,1),
ED_1yr_unk = sum(is.na(ED_visits_past_yr)),
ED_1yr_0 = sum(ED_visits_past_yr==0,na.rm=TRUE),
ED_1yr_1 = sum(ED_visits_past_yr==1,na.rm=TRUE),
ED_1yr_2 = sum(ED_visits_past_yr>1,na.rm=TRUE),
ED_1yr_unk_perc = round(sum(is.na(ED_visits_past_yr))/length(ED_visits_past_yr)*100,1),
ED_1yr_0_perc = round(sum(ED_visits_past_yr==0,na.rm=TRUE)/length(ED_visits_past_yr)*100,1) ,
ED_1yr_1_perc = round(sum(ED_visits_past_yr==1,na.rm=TRUE)/length(ED_visits_past_yr)*100,1),
ED_1yr_2_perc = round(sum(ED_visits_past_yr>1,na.rm=TRUE)/length(ED_visits_past_yr)*100,1),
#rhinosin_sx = ,
#rhinosin_sx_perc = ,
race_asian= race_t[1],
race_black_AA= race_t[2],
race_more_than1= race_t[3],
race_unk = race_t[4],
race_wt = race_t[5],
race_asian_perc= round(race_t[1]/sum(race_t)*100,1),
race_black_AA_perc= round(race_t[2]/sum(race_t)*100,1),
race_more_than1_perc= round(race_t[3]/sum(race_t)*100,1),
race_unk_perc = round(race_t[4]/sum(race_t)*100,1),
race_wt_perc = round(race_t[5]/sum(race_t)*100,1),
ethnicity_lat=table(BoA_phen_BAL$Ethnicity)[1],
ethnicity_lat_perc=round(table(BoA_phen_BAL$Ethnicity)[1]/sum(table(BoA_phen_BAL$Ethnicity))*100,1),
race_asian_perc= round(race_t[1]/sum(race_t)*100,1),
asthma_med_ICS = length(which(ICS=="Checked")),
asthma_med_SABA= length(which(SABA=="Checked")),
asthma_med_ICS_LABA = length(which(ICS.LABA=="Checked")),
asthma_med_LTR =  length(which(LTR=="Checked")),
asthma_med_xolair.omalizumab = length(which(xolair.omalizumab=="Checked")),
asthma_med_nucala.Mepolizumab = length(which(nucala.Mepolizumab=="Checked")),
asthma_med_fasenra.benralizumab = length(which(fasenra.benralizumab=="Checked")),
asthma_med_atrovent = length(which(atrovent=="Checked")),
##
asthma_med_ICS_perc = round(length(which(ICS=="Checked"))/length(ICS)*100,1),
asthma_med_SABA_perc= round(length(which(SABA=="Checked"))/length(SABA)*100,1),
asthma_med_ICS_LABA_perc = round(length(which(ICS.LABA=="Checked"))/length(ICS.LABA)*100,1),
asthma_med_LTR_perc = round( length(which(LTR=="Checked"))/length(LTR)*100,1),
asthma_med_xolair.omalizumab_perc = round(length(which(xolair.omalizumab=="Checked"))/length(xolair.omalizumab)*100,1),
asthma_med_nucala.Mepolizumab_perc = round(length(which(nucala.Mepolizumab=="Checked"))/length(nucala.Mepolizumab)*100,1),
asthma_med_fasenra.benralizumab_perc = round(length(which(fasenra.benralizumab=="Checked"))/length(fasenra.benralizumab)*100,1),
asthma_med_atrovent_perc = round(length(which(atrovent=="Checked"))/length(atrovent)*100,1)
)
write.csv(BoA_phen_BAL_summary,"./reports/phenotyping/subject_demographic_summary.csv")
write.csv(BoA_phen_BAL_summary,"./reports/phenotyping/subject_demographic_summary.csv")
BoA_phen_BAL_summary<-BoA_phen_BAL%>%summarize(
Age_mean= round(mean(Age_at_visit),1),
age_sd = round(sd(Age_at_visit),1),
sex_f_numb = length(which(Sex=="Female")),
sex_f_perc = round(length(which(Sex=="Female"))/length(Sex)*100,1),
ACT_mean =  round(mean(ACT_score),1),
ACT_sd = round(sd(ACT_score),1),
fev1_pred_mean = round(mean(FEV1_percent,na.rm = TRUE),1),
fev1_pred_sd = round(sd(FEV1_percent,na.rm = TRUE),1),
fev1_fvc_rat_mean = round(mean(FEV1.FVC,na.rm = TRUE),1),
fev1_fvc_rat_sd = round(sd(FEV1.FVC,na.rm = TRUE),1),
all_sens = sum(allergy=="Checked"),
all_sens_perc = round(sum(allergy=="Checked")/sum(table(allergy))*100,1),
hosp_1yr_unk = sum(is.na(admit_count)),
hosp_1yr_0 = sum(admit_count==0,na.rm=TRUE),
hosp_1yr_1 = sum(admit_count==1,na.rm=TRUE),
hosp_1yr_2 = sum(admit_count>1,na.rm=TRUE),
hosp_1yr_unk_perc = round(sum(is.na(admit_count))/length(admit_count)*100,1),
hosp_1yr_0_perc = round(sum(admit_count==0,na.rm=TRUE)/length(admit_count)*100,1) ,
hosp_1yr_1_perc = round(sum(admit_count==1,na.rm=TRUE)/length(admit_count)*100,1),
hosp_1yr_2_perc = round(sum(admit_count>1,na.rm=TRUE)/length(admit_count)*100,1),
ED_1yr_unk = sum(is.na(ED_visits_past_yr)),
ED_1yr_0 = sum(ED_visits_past_yr==0,na.rm=TRUE),
ED_1yr_1 = sum(ED_visits_past_yr==1,na.rm=TRUE),
ED_1yr_2 = sum(ED_visits_past_yr>1,na.rm=TRUE),
ED_1yr_unk_perc = round(sum(is.na(ED_visits_past_yr))/length(ED_visits_past_yr)*100,1),
ED_1yr_0_perc = round(sum(ED_visits_past_yr==0,na.rm=TRUE)/length(ED_visits_past_yr)*100,1) ,
ED_1yr_1_perc = round(sum(ED_visits_past_yr==1,na.rm=TRUE)/length(ED_visits_past_yr)*100,1),
ED_1yr_2_perc = round(sum(ED_visits_past_yr>1,na.rm=TRUE)/length(ED_visits_past_yr)*100,1),
#rhinosin_sx = ,
#rhinosin_sx_perc = ,
race_asian= race_t[1],
race_black_AA= race_t[2],
race_more_than1= race_t[3],
race_unk = race_t[4],
race_wt = race_t[5],
race_asian_perc= round(race_t[1]/sum(race_t)*100,1),
race_black_AA_perc= round(race_t[2]/sum(race_t)*100,1),
race_more_than1_perc= round(race_t[3]/sum(race_t)*100,1),
race_unk_perc = round(race_t[4]/sum(race_t)*100,1),
race_wt_perc = round(race_t[5]/sum(race_t)*100,1),
ethnicity_lat=table(BoA_phen_BAL$Ethnicity)[1],
ethnicity_lat_perc=round(table(BoA_phen_BAL$Ethnicity)[1]/sum(table(BoA_phen_BAL$Ethnicity))*100,1),
race_asian_perc= round(race_t[1]/sum(race_t)*100,1),
asthma_med_ICS = length(which(ICS=="Checked")),
asthma_med_SABA= length(which(SABA=="Checked")),
asthma_med_ICS_LABA = length(which(ICS.LABA=="Checked")),
asthma_med_LTR =  length(which(LTR=="Checked")),
asthma_med_xolair.omalizumab = length(which(xolair.omalizumab=="Checked")),
asthma_med_nucala.Mepolizumab = length(which(nucala.Mepolizumab=="Checked")),
asthma_med_fasenra.benralizumab = length(which(fasenra.benralizumab=="Checked")),
asthma_med_atrovent = length(which(atrovent=="Checked")),
##
asthma_med_ICS_perc = round(length(which(ICS=="Checked"))/length(ICS)*100,1),
asthma_med_SABA_perc= round(length(which(SABA=="Checked"))/length(SABA)*100,1),
asthma_med_ICS_LABA_perc = round(length(which(ICS.LABA=="Checked"))/length(ICS.LABA)*100,1),
asthma_med_LTR_perc = round( length(which(LTR=="Checked"))/length(LTR)*100,1),
asthma_med_xolair.omalizumab_perc = round(length(which(xolair.omalizumab=="Checked"))/length(xolair.omalizumab)*100,1),
asthma_med_nucala.Mepolizumab_perc = round(length(which(nucala.Mepolizumab=="Checked"))/length(nucala.Mepolizumab)*100,1),
asthma_med_fasenra.benralizumab_perc = round(length(which(fasenra.benralizumab=="Checked"))/length(fasenra.benralizumab)*100,1),
asthma_med_atrovent_perc = round(length(which(atrovent=="Checked"))/length(atrovent)*100,1)
)
write.csv(BoA_phen_BAL_summary,"./reports/phenotyping/subject_demographic_summary.csv")
BoA_phen_BAL$SABA
BoA_phen_BAL_summary$asthma_med_SABA_perc
BoA_phen_BAL_summary[grep("^asthma_med",names(BoA_phen_BAL_summary))]
ggplot(data=BoA_phen_BAL,aes(x=ICS,y=ICS.LABA))+
geom_point()
ggplot(data=BoA_phen_BAL,aes(x=ICS,y=ICS.LABA))+
geom_bin2d()
ggplot(data=BoA_phen_BAL,aes(x=ICS/sum(table(ICS)),y=ICS.LABA/sum(table(ICS.LABA))))+
geom_bin2d()
table(BoA_phen_BAL$ICS)
table(BoA_phen_BAL$ICS)%>%sum
ggplot(data=BoA_phen_BAL,aes(x=ICS/sum(table(BoA_phen_BAL$ICS)),y=ICS.LABA/sum(table(BoA_phen_BAL$ICS.LABA))))+
geom_bin2d()
ggplot(data=BoA_phen_BAL,aes(x=ICS,y=ICS.LABA))+
geom_bin2d()
ggplot(data=BoA_phen_BAL,aes(x=ICS,y=ICS.LABA))+
geom_bin2d()+
stat_summary_2d(
fun = function(z) round(mean(z), 2), # Calculate mean of values in each bin
aes(label = stat(value)), # Label with the calculated mean
geom = "text", # Use text for labeling
size = 3, # Set size of the text
vjust = 1.5 # Adjust vertical position of text
)
ggplot(data=BoA_phen_BAL,aes(x=ICS,y=ICS.LABA))+
geom_bin2d()+
after_stat(
fun = function(z) round(mean(z), 2), # Calculate mean of values in each bin
aes(label = stat(value)), # Label with the calculated mean
geom = "text", # Use text for labeling
size = 3, # Set size of the text
vjust = 1.5 # Adjust vertical position of text
)
ggplot(data=BoA_phen_BAL,aes(x=ICS,y=ICS.LABA))+
geom_bin2d()
bin_counts <- BoA_phen_BAL %>%
group_by(ICS, ICS.LABA) %>%
summarise(count = n())
ggplot(data=BoA_phen_BAL,aes(x=ICS,y=ICS.LABA))+
geom_bin2d()+
geom_text(data = bin_counts, aes(label = count),
position = position_bin2d(binwidth = NULL),
size = 3, vjust = 1.5)
ggplot(data=BoA_phen_BAL,aes(x=ICS,y=ICS.LABA))+
geom_bin2d()+
geom_text(data = bin_counts, aes(label = count),
size = 3, vjust = 1.5)
ggplot(data=BoA_phen_BAL,aes(x=ICS,y=ICS.LABA))+
geom_bin2d()+
geom_text(data = bin_counts, aes(label = count),
size = 10, vjust = 1.5)
bin_counts
bin_counts <- BoA_phen_BAL %>%
group_by(ICS, LTR) %>%
summarise(count = n())
ggplot(data=BoA_phen_BAL,aes(x=ICS,y=LTR))+
geom_bin2d()+
geom_text(data = bin_counts, aes(label = count),
size = 10, vjust = 1.5)
bin_counts <- BoA_phen_BAL %>%
group_by(ICS, ICS.LABA) %>%
summarise(count = n())
ggplot(data=BoA_phen_BAL,aes(x=ICS,y=LTR))+
geom_bin2d()+
geom_text(data = bin_counts, aes(label = count),
size = 10, vjust = 1.5)
bin_counts <- BoA_phen_BAL %>%
group_by(ICS, ICS.LABA) %>%
summarise(count = n())
ggplot(data=BoA_phen_BAL,aes(x=ICS,y=ICS.LABA))+
geom_bin2d()+
geom_text(data = bin_counts, aes(label = count),
size = 10, vjust = 1.5)
ggplot(data=BoA_phen_BAL,aes(x=ICS,y=ICS.LABA))+
geom_bin2d()+
geom_text(data = bin_counts, aes(label = count),
size = 10)
